<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ - Elite Investors</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, sans-serif;
        }
        body {
            background: #0f172a;
            color: white;
            padding: 20px;
            direction: rtl;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        h1 {
            color: #7c3aed;
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }
        .card {
            background: #1e293b;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #7c3aed;
        }
        .card-title {
            color: #7c3aed;
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-item {
            background: #0f172a;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
        }
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .test-name {
            font-weight: bold;
            color: #cbd5e1;
        }
        .status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-success {
            background: #10b98120;
            color: #10b981;
            border: 1px solid #10b981;
        }
        .status-error {
            background: #ef444420;
            color: #ef4444;
            border: 1px solid #ef4444;
        }
        .status-warning {
            background: #f59e0b20;
            color: #f59e0b;
            border: 1px solid #f59e0b;
        }
        .details {
            background: #00000030;
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            color: #94a3b8;
            word-break: break-word;
            margin-top: 10px;
        }
        .btn {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            width: 100%;
            margin: 5px 0;
            cursor: pointer;
            font-size: 16px;
        }
        .btn-success {
            background: #10b981;
        }
        .btn-warning {
            background: #f59e0b;
        }
        .package-box {
            background: #2d3a4f;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-right: 5px solid #7c3aed;
        }
        .package-name {
            font-size: 18px;
            font-weight: bold;
            color: #7c3aed;
        }
        .package-price {
            color: #10b981;
            font-size: 16px;
        }
        .log {
            background: #00000050;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            color: #94a3b8;
            max-height: 200px;
            overflow-y: auto;
        }
        .row {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ØªØ´Ø®ÙŠØµ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</h1>
        
        <div class="card">
            <div class="card-title">
                <span>ğŸ“¡ 1. ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase</span>
            </div>
            <button class="btn" onclick="testConnection()">Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ</button>
            <div id="connection-result" class="details" style="margin-top: 15px;"></div>
        </div>

        <div class="card">
            <div class="card-title">
                <span>ğŸ“¦ 2. ÙØ­Øµ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</span>
            </div>
            <button class="btn" onclick="testPackages()">Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</button>
            <div id="packages-result" class="details" style="margin-top: 15px;"></div>
        </div>

        <div class="card">
            <div class="card-title">
                <span>ğŸ”§ 3. Ø¥ØµÙ„Ø§Ø­ Ø³Ø±ÙŠØ¹</span>
            </div>
            <button class="btn btn-success" onclick="fixPackages()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</button>
            <button class="btn btn-warning" onclick="clearCache()">Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´</button>
            <div id="fix-result" class="details" style="margin-top: 15px;"></div>
        </div>

        <div class="card">
            <div class="card-title">
                <span>ğŸ“‹ 4. Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</span>
            </div>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase
        const SUPABASE_URL = 'https://kjivdgfacwvdcfaxdedb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtqaXZkZ2ZhY3d2ZGNmYXhkZWRiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5ODY1MDksImV4cCI6MjA4NjU2MjUwOX0.3SW2jU-Cu3i4Ms5yIFjaDZZ8DQCVI78Rc0ZIyFeFaXo';

        let supabase = null;

        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#94a3b8';
            logDiv.innerHTML = `<div style="color: ${color}">[${time}] ${message}</div>` + logDiv.innerHTML;
        }

        // ØªÙ‡ÙŠØ¦Ø© Supabase
        async function initSupabase() {
            try {
                if (!supabase) {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    addLog('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…ÙŠÙ„ Supabase', 'success');
                }
                return supabase;
            } catch (e) {
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„: ' + e.message, 'error');
                return null;
            }
        }

        // 1. ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„
        async function testConnection() {
            const resultDiv = document.getElementById('connection-result');
            resultDiv.innerHTML = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...';
            addLog('Ø¨Ø¯Ø¡ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„...');

            try {
                const client = await initSupabase();
                if (!client) throw new Error('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„');

                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¬Ø¯ÙˆÙ„ packages
                const { data, error } = await client
                    .from('packages')
                    .select('count', { count: 'exact', head: true });

                if (error) {
                    if (error.code === '42P01') {
                        throw new Error('Ø¬Ø¯ÙˆÙ„ packages ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ - ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                    } else if (error.code === '42501') {
                        throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (RLS)');
                    } else {
                        throw new Error(error.message);
                    }
                }

                resultDiv.innerHTML = `
                    <div style="color: #10b981;">âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­!</div>
                    <div style="margin-top: 10px;">âœ… Supabase Ù…ØªØµÙ„ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„</div>
                `;
                addLog('âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­', 'success');

            } catch (e) {
                resultDiv.innerHTML = `<div style="color: #ef4444;">âŒ Ø®Ø·Ø£: ${e.message}</div>`;
                addLog('âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ' + e.message, 'error');
            }
        }

        // 2. ÙØ­Øµ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
        async function testPackages() {
            const resultDiv = document.getElementById('packages-result');
            resultDiv.innerHTML = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª...';
            addLog('Ø¨Ø¯Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª...');

            try {
                const client = await initSupabase();
                if (!client) throw new Error('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„');

                // Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
                const { data, error } = await client
                    .from('packages')
                    .select('*');

                if (error) throw error;

                if (!data || data.length === 0) {
                    resultDiv.innerHTML = `
                        <div style="color: #f59e0b;">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ù‚Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                        <div style="margin-top: 10px;">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©" Ù„Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</div>
                    `;
                    addLog('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ù‚Ø§Øª', 'warning');
                    return;
                }

                let html = `<div style="color: #10b981;">âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data.length} Ø¨Ø§Ù‚Ø§Øª:</div>`;
                data.forEach((pkg, index) => {
                    html += `
                        <div class="package-box">
                            <div class="package-name">${pkg.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
                            <div class="package-price">ğŸ’° ${pkg.price || 0}$</div>
                            <div style="margin-top: 5px; color: #94a3b8;">
                                ğŸ“Š Ø§Ù„ÙØ¦Ø©: ${pkg.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}<br>
                                ğŸ“ˆ Ø§Ù„Ø±Ø¨Ø­: ${pkg.profit || 2.5}%<br>
                                ğŸ†” ID: ${pkg.id || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}
                            </div>
                        </div>
                    `;
                });
                resultDiv.innerHTML = html;
                addLog(`âœ… ØªÙ… Ø¬Ù„Ø¨ ${data.length} Ø¨Ø§Ù‚Ø§Øª`, 'success');

            } catch (e) {
                resultDiv.innerHTML = `<div style="color: #ef4444;">âŒ Ø®Ø·Ø£: ${e.message}</div>`;
                addLog('âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª: ' + e.message, 'error');
            }
        }

        // 3. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        async function fixPackages() {
            const resultDiv = document.getElementById('fix-result');
            resultDiv.innerHTML = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª...';
            addLog('Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª...');

            try {
                const client = await initSupabase();
                if (!client) throw new Error('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„');

                // Ø­Ø°Ù Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                await client.from('packages').delete().neq('id', '0');

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                const packages = [
                    {
                        id: '11111111-1111-1111-1111-111111111111',
                        name: 'Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„ÙØ¶ÙŠØ©',
                        price: 500,
                        profit: 2.5,
                        daily_profit: 12.5,
                        tasks: 5,
                        duration: 30,
                        category: 'standard',
                        description: 'Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†',
                        status: 'active'
                    },
                    {
                        id: '22222222-2222-2222-2222-222222222222',
                        name: 'Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©',
                        price: 1000,
                        profit: 2.5,
                        daily_profit: 25,
                        tasks: 5,
                        duration: 30,
                        category: 'premium',
                        description: 'Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹',
                        status: 'active'
                    },
                    {
                        id: '33333333-3333-3333-3333-333333333333',
                        name: 'Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø§Ø³ÙŠØ©',
                        price: 5000,
                        profit: 2.5,
                        daily_profit: 125,
                        tasks: 5,
                        duration: 30,
                        category: 'vip',
                        description: 'Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø§Ù„Ø¹ÙˆØ§Ø¦Ø¯',
                        status: 'active'
                    }
                ];

                const { error } = await client
                    .from('packages')
                    .insert(packages);

                if (error) throw error;

                resultDiv.innerHTML = '<div style="color: #10b981;">âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!</div>';
                addLog('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª', 'success');

                // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©
                await testPackages();

            } catch (e) {
                resultDiv.innerHTML = `<div style="color: #ef4444;">âŒ Ø®Ø·Ø£: ${e.message}</div>`;
                addLog('âŒ ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª: ' + e.message, 'error');
            }
        }

        // 4. Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´
        function clearCache() {
            localStorage.clear();
            sessionStorage.clear();
            addLog('âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ', 'success');
            alert('âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´. Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
            location.reload();
        }

        // ØªØ´ØºÙŠÙ„ ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            setTimeout(testConnection, 500);
        };
    </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Supabase</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            background: #0f172a;
            color: white;
            font-family: Arial;
            padding: 20px;
            text-align: center;
        }
        button {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            margin: 10px;
            width: 90%;
            cursor: pointer;
        }
        .result {
            background: #1e293b;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: right;
            font-size: 14px;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Supabase</h1>
    <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„Ù„ÙØ­Øµ</p>

    <button onclick="testConnection()">ğŸ“¡ 1. ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„</button>
    <button onclick="testUsers()">ğŸ‘¥ 2. ÙØ­Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
    <button onclick="testPackages()">ğŸ“¦ 3. ÙØ­Øµ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</button>
    <button onclick="testLogin()">ğŸ”‘ 4. ØªØ¬Ø±Ø¨Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    <button onclick="clearAll()">ğŸ§¹ ØªÙ†Ø¸ÙŠÙ localStorage</button>

    <div class="result" id="result">
        Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Supabase
        const SUPABASE_URL = 'https://kfwbcewtnfoofllhxron.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtmd2JjZXd0bmZvb2ZsbGh4cm9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MjEwMzksImV4cCI6MjA4NjQ5NzAzOX0.Mgf7Dg4Ji3eKHQPz3SUGTfwSfsl7anYneA4ZPIYgbIU';

        let supabase = null;

        function showResult(text, isError = false) {
            document.getElementById('result').innerHTML = 
                `<div class="${isError ? 'error' : 'success'}">${text}</div>`;
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø§ØªØµØ§Ù„
        async function initSupabase() {
            try {
                if (!supabase) {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                }
                return true;
            } catch (e) {
                showResult('âŒ Ø®Ø·Ø£: ' + e.message, true);
                return false;
            }
        }

        // 1. ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„
        async function testConnection() {
            showResult('ğŸ”„ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„...');
            
            if (!await initSupabase()) return;
            
            try {
                const { error } = await supabase.from('users').select('count', { count: 'exact', head: true });
                
                if (error) {
                    if (error.code === '42P01') {
                        showResult('âŒ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©! ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.', true);
                    } else if (error.code === '42501') {
                        showResult('âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (RLS). Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± ØªÙ†Ø¸ÙŠÙ localStorage Ø«Ù… Ø¬Ø±Ø¨.', true);
                    } else {
                        showResult('âŒ Ø®Ø·Ø£: ' + error.message, true);
                    }
                } else {
                    showResult('âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­! Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø´ØºØ§Ù„Ø©.');
                }
            } catch (e) {
                showResult('âŒ Ø®Ø·Ø£: ' + e.message, true);
            }
        }

        // 2. ÙØ­Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        async function testUsers() {
            showResult('ğŸ”„ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...');
            
            if (!await initSupabase()) return;
            
            try {
                const { data, error } = await supabase.from('users').select('*');
                
                if (error) {
                    showResult('âŒ Ø®Ø·Ø£: ' + error.message, true);
                } else if (!data || data.length === 0) {
                    showResult('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
                } else {
                    let text = 'âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:\n';
                    data.forEach(u => {
                        text += `\nğŸ‘¤ ${u.username} | ÙƒÙ„Ù…Ø©: ${u.password} | ${u.is_admin ? 'Ù…Ø´Ø±Ù' : 'Ù…Ø³ØªØ®Ø¯Ù…'}`;
                    });
                    showResult(text);
                }
            } catch (e) {
                showResult('âŒ Ø®Ø·Ø£: ' + e.message, true);
            }
        }

        // 3. ÙØ­Øµ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
        async function testPackages() {
            showResult('ğŸ”„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª...');
            
            if (!await initSupabase()) return;
            
            try {
                const { data, error } = await supabase.from('packages').select('*');
                
                if (error) {
                    showResult('âŒ Ø®Ø·Ø£: ' + error.message, true);
                } else if (!data || data.length === 0) {
                    showResult('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø§Ù‚Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
                } else {
                    let text = 'âœ… Ø§Ù„Ø¨Ø§Ù‚Ø§Øª:\n';
                    data.forEach(p => {
                        text += `\nğŸ“¦ ${p.name} | ${p.price}$`;
                    });
                    showResult(text);
                }
            } catch (e) {
                showResult('âŒ Ø®Ø·Ø£: ' + e.message, true);
            }
        }

        // 4. ØªØ¬Ø±Ø¨Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function testLogin() {
            showResult('ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...');
            
            if (!await initSupabase()) return;
            
            try {
                // Ø¬Ø±Ø¨ admin
                const { data, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('username', 'admin')
                    .eq('password', 'admin123')
                    .maybeSingle();
                
                if (error) {
                    showResult('âŒ Ø®Ø·Ø£: ' + error.message, true);
                } else if (data) {
                    showResult(`âœ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­! Ù…Ø±Ø­Ø¨Ø§Ù‹ ${data.name} (Ù…Ø´Ø±Ù)`);
                    
                    // Ø­ÙØ¸ ÙÙŠ localStorage
                    localStorage.setItem('current_user', JSON.stringify(data));
                } else {
                    // Ø¬Ø±Ø¨ ahmed
                    const { data: data2 } = await supabase
                        .from('users')
                        .select('*')
                        .eq('username', 'ahmed')
                        .eq('password', '123456')
                        .maybeSingle();
                    
                    if (data2) {
                        showResult(`âœ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­! Ù…Ø±Ø­Ø¨Ø§Ù‹ ${data2.name}`);
                        localStorage.setItem('current_user', JSON.stringify(data2));
                    } else {
                        showResult('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†. ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØªÙ‡Ù… Ø£ÙˆÙ„Ø§Ù‹.', true);
                    }
                }
            } catch (e) {
                showResult('âŒ Ø®Ø·Ø£: ' + e.message, true);
            }
        }

        // ØªÙ†Ø¸ÙŠÙ
        function clearAll() {
            localStorage.clear();
            sessionStorage.clear();
            showResult('âœ… ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ. Ø¬Ø±Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†.');
        }
    </script>
</body>
</html>
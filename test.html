<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ - Elite Investors</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, sans-serif;
        }
        body {
            background: #0f172a;
            color: white;
            padding: 15px;
            direction: rtl;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        h1 {
            color: #7c3aed;
            text-align: center;
            margin-bottom: 20px;
            font-size: 22px;
        }
        .card {
            background: #1e293b;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #7c3aed;
        }
        .card-title {
            color: #7c3aed;
            font-size: 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            width: 100%;
            margin: 5px 0;
            cursor: pointer;
            font-size: 15px;
        }
        .btn-success {
            background: #10b981;
        }
        .btn-warning {
            background: #f59e0b;
        }
        .result-box {
            background: #0f172a;
            border-radius: 10px;
            padding: 12px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 13px;
            color: #94a3b8;
            word-break: break-word;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
        .package-item {
            background: #2d3a4f;
            border-radius: 8px;
            padding: 10px;
            margin: 8px 0;
            border-right: 3px solid #7c3aed;
        }
        .row {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ØªØ´Ø®ÙŠØµ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</h1>
        
        <div class="card">
            <div class="card-title">ğŸ“¡ 1. ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„</div>
            <button class="btn" onclick="testConnection()">Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ</button>
            <div id="connectionResult" class="result-box"></div>
        </div>

        <div class="card">
            <div class="card-title">ğŸ“¦ 2. ÙØ­Øµ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</div>
            <button class="btn" onclick="testPackages()">Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</button>
            <div id="packagesResult" class="result-box"></div>
        </div>

        <div class="card">
            <div class="card-title">ğŸ“Š 3. ÙØ­Øµ shared-data</div>
            <button class="btn" onclick="testSharedData()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙˆØ§Ù„</button>
            <div id="sharedResult" class="result-box"></div>
        </div>

        <div class="card">
            <div class="card-title">ğŸ”„ 4. Ø­Ù„ Ø³Ø±ÙŠØ¹</div>
            <div class="row">
                <button class="btn btn-success" style="flex:1" onclick="addPackages()">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚Ø§Øª</button>
                <button class="btn btn-warning" style="flex:1" onclick="clearCache()">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´</button>
            </div>
            <div id="fixResult" class="result-box"></div>
        </div>
    </div>

    <script>
        // ========== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase ==========
        const SUPABASE_URL = 'https://kjivdgfacwvdcfaxdedb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtqaXZkZ2ZhY3d2ZGNmYXhkZWRiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5ODY1MDksImV4cCI6MjA4NjU2MjUwOX0.3SW2jU-Cu3i4Ms5yIFjaDZZ8DQCVI78Rc0ZIyFeFaXo';

        let supabase = null;

        // ========== ØªÙ‡ÙŠØ¦Ø© Supabase ==========
        async function getSupabase() {
            if (!supabase) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            }
            return supabase;
        }

        // ========== 1. ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ ==========
        async function testConnection() {
            const result = document.getElementById('connectionResult');
            result.innerHTML = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...';
            
            try {
                const client = await getSupabase();
                
                // Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø³ÙŠØ·
                const { error } = await client
                    .from('packages')
                    .select('count', { count: 'exact', head: true });
                
                if (error) {
                    if (error.code === '42P01') {
                        result.innerHTML = '<span class="error">âŒ Ø¬Ø¯ÙˆÙ„ packages ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</span>';
                    } else if (error.code === '42501') {
                        result.innerHTML = '<span class="error">âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (RLS)</span>';
                    } else {
                        result.innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${error.message}</span>`;
                    }
                } else {
                    result.innerHTML = '<span class="success">âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­</span>';
                }
            } catch (e) {
                result.innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${e.message}</span>`;
            }
        }

        // ========== 2. ÙØ­Øµ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª ==========
        async function testPackages() {
            const result = document.getElementById('packagesResult');
            result.innerHTML = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª...';
            
            try {
                const client = await getSupabase();
                
                const { data, error } = await client
                    .from('packages')
                    .select('*');
                
                if (error) {
                    result.innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${error.message}</span>`;
                    return;
                }
                
                if (!data || data.length === 0) {
                    result.innerHTML = '<span class="warning">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ù‚Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>';
                    return;
                }
                
                let html = `<span class="success">âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data.length} Ø¨Ø§Ù‚Ø§Øª:</span>`;
                data.forEach(pkg => {
                    html += `
                        <div class="package-item">
                            <div style="font-weight:bold; color:#7c3aed;">${pkg.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
                            <div>ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${pkg.price || 0}$</div>
                            <div>ğŸ“Š Ø§Ù„ÙØ¦Ø©: ${pkg.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}</div>
                            <div style="font-size:11px; color:#94a3b8;">ğŸ†” ${pkg.id || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</div>
                        </div>
                    `;
                });
                result.innerHTML = html;
                
            } catch (e) {
                result.innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${e.message}</span>`;
            }
        }

        // ========== 3. ÙØ­Øµ shared-data ==========
        async function testSharedData() {
            const result = document.getElementById('sharedResult');
            result.innerHTML = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...';
            
            try {
                // Ù‡Ù„ shared-data Ù…ÙˆØ¬ÙˆØ¯ØŸ
                if (!window.sharedData) {
                    result.innerHTML = '<span class="error">âŒ shared-data ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</span>';
                    return;
                }
                
                result.innerHTML = 'âœ… shared-data Ù…ÙˆØ¬ÙˆØ¯<br>';
                
                // Ø§Ø®ØªØ¨Ø§Ø± getAllPackages
                try {
                    const packages = await window.sharedData.getAllPackages();
                    result.innerHTML += `ğŸ“¦ getAllPackages: ${packages?.length || 0} Ø¨Ø§Ù‚Ø©<br>`;
                } catch (e) {
                    result.innerHTML += `<span class="error">âŒ getAllPackages ÙØ´Ù„: ${e.message}</span><br>`;
                }
                
                // Ø§Ø®ØªØ¨Ø§Ø± getDashboardStats
                try {
                    const stats = await window.sharedData.getDashboardStats();
                    result.innerHTML += `ğŸ“Š getDashboardStats: Ù†Ø§Ø¬Ø­<br>`;
                } catch (e) {
                    result.innerHTML += `<span class="error">âŒ getDashboardStats ÙØ´Ù„: ${e.message}</span><br>`;
                }
                
            } catch (e) {
                result.innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${e.message}</span>`;
            }
        }

        // ========== 4. Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚Ø§Øª ==========
        async function addPackages() {
            const result = document.getElementById('fixResult');
            result.innerHTML = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª...';
            
            try {
                const client = await getSupabase();
                
                // Ø­Ø°Ù Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
                await client.from('packages').delete().neq('id', '0');
                
                // Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
                const packages = [
                    {
                        id: '11111111-1111-1111-1111-111111111111',
                        name: 'Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„ÙØ¶ÙŠØ©',
                        price: 500,
                        profit: 2.5,
                        daily_profit: 12.5,
                        tasks: 5,
                        duration: 30,
                        category: 'standard',
                        description: 'Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†',
                        status: 'active'
                    },
                    {
                        id: '22222222-2222-2222-2222-222222222222',
                        name: 'Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©',
                        price: 1000,
                        profit: 2.5,
                        daily_profit: 25,
                        tasks: 5,
                        duration: 30,
                        category: 'premium',
                        description: 'Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹',
                        status: 'active'
                    },
                    {
                        id: '33333333-3333-3333-3333-333333333333',
                        name: 'Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø§Ø³ÙŠØ©',
                        price: 5000,
                        profit: 2.5,
                        daily_profit: 125,
                        tasks: 5,
                        duration: 30,
                        category: 'vip',
                        description: 'Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø§Ù„Ø¹ÙˆØ§Ø¦Ø¯',
                        status: 'active'
                    }
                ];
                
                const { error } = await client
                    .from('packages')
                    .insert(packages);
                
                if (error) throw error;
                
                result.innerHTML = '<span class="success">âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø¨Ù†Ø¬Ø§Ø­</span>';
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
                setTimeout(testPackages, 500);
                
            } catch (e) {
                result.innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${e.message}</span>`;
            }
        }

        // ========== Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´ ==========
        function clearCache() {
            localStorage.clear();
            sessionStorage.clear();
            alert('âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´. Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
            location.reload();
        }

        // ========== ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ==========
        window.onload = function() {
            setTimeout(testConnection, 500);
        };
    </script>
</body>
</html>
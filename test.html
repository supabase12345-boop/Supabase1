<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Supabase - Ø¨Ø³ÙŠØ·</title>
    <style>
        body {
            background: #0f172a;
            color: white;
            font-family: Arial;
            padding: 20px;
            text-align: center;
            direction: rtl;
        }
        h1 {
            color: #7c3aed;
            font-size: 24px;
        }
        button {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 18px;
            margin: 10px 0;
            width: 100%;
            cursor: pointer;
            font-weight: bold;
        }
        .result-box {
            background: #1e293b;
            border: 2px solid #7c3aed;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: right;
            min-height: 100px;
            font-size: 16px;
            direction: ltr;
        }
        .success {
            color: #10b981;
            font-weight: bold;
        }
        .error {
            color: #ef4444;
            font-weight: bold;
        }
        .info {
            color: #3b82f6;
        }
        hr {
            border: 1px solid #334155;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Supabase</h1>
    <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„Ù„ÙØ­Øµ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</p>

    <button onclick="testConnection()">ğŸ“¡ 1. ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    <button onclick="testUsers()">ğŸ‘¥ 2. Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
    <button onclick="testPackages()">ğŸ“¦ 3. Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</button>
    <button onclick="testLogin()">ğŸ”‘ 4. ØªØ¬Ø±Ø¨Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (admin/admin123)</button>
    <button onclick="clearStorage()">ğŸ§¹ 5. ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ</button>

    <hr>

    <div class="result-box" id="result">
        â³ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Supabase Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø©
        const SUPABASE_URL = 'https://kfwbcewtnfoofllhxron.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtmd2JjZXd0bmZvb2ZsbGh4cm9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MjEwMzksImV4cCI6MjA4NjQ5NzAzOX0.Mgf7Dg4Ji3eKHQPz3SUGTfwSfsl7anYneA4ZPIYgbIU';

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function showResult(text, type = 'info') {
            const resultDiv = document.getElementById('result');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            resultDiv.innerHTML = `<div class="${className}">${text}</div>`;
            console.log(text);
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase (Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø©)
        async function fetchFromSupabase(table) {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?select=*`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(`HTTP ${response.status}: ${error}`);
                }
                
                return await response.json();
            } catch (error) {
                throw error;
            }
        }

        // 1. ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„
        async function testConnection() {
            showResult('ğŸ”„ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„...', 'info');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    showResult('âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­! Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø´ØºØ§Ù„Ø©', 'success');
                } else {
                    showResult(`âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${response.status}`, 'error');
                }
            } catch (error) {
                showResult(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
            }
        }

        // 2. Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        async function testUsers() {
            showResult('ğŸ”„ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...', 'info');
            
            try {
                const users = await fetchFromSupabase('users');
                
                if (!users || users.length === 0) {
                    showResult('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'info');
                } else {
                    let result = 'âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:\n\n';
                    users.forEach(user => {
                        result += `ğŸ‘¤ ${user.username} / ${user.password}`;
                        if (user.is_admin) result += ' (ğŸ‘‘ Ù…Ø´Ø±Ù)';
                        result += `\n   ğŸ“§ ${user.email}`;
                        result += `\n   ğŸ’° ${user.balance || 0}$\n\n`;
                    });
                    showResult(result, 'success');
                }
            } catch (error) {
                if (error.message.includes('404')) {
                    showResult('âŒ Ø¬Ø¯ÙˆÙ„ users ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯! ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                } else if (error.message.includes('401') || error.message.includes('403')) {
                    showResult('âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (RLS) - Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ', 'error');
                } else {
                    showResult(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
                }
            }
        }

        // 3. Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
        async function testPackages() {
            showResult('ğŸ”„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª...', 'info');
            
            try {
                const packages = await fetchFromSupabase('packages');
                
                if (!packages || packages.length === 0) {
                    showResult('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø§Ù‚Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'info');
                } else {
                    let result = 'âœ… Ø§Ù„Ø¨Ø§Ù‚Ø§Øª:\n\n';
                    packages.forEach(pkg => {
                        result += `ğŸ“¦ ${pkg.name}\n`;
                        result += `   ğŸ’° ${pkg.price}$\n`;
                        result += `   ğŸ“ˆ Ø±Ø¨Ø­: ${pkg.profit || 2.5}%\n\n`;
                    });
                    showResult(result, 'success');
                }
            } catch (error) {
                if (error.message.includes('404')) {
                    showResult('âŒ Ø¬Ø¯ÙˆÙ„ packages ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!', 'error');
                } else {
                    showResult(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
                }
            }
        }

        // 4. ØªØ¬Ø±Ø¨Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function testLogin() {
            showResult('ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...', 'info');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/users?username=eq.admin&password=eq.admin123&select=*`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                const users = await response.json();
                
                if (users && users.length > 0) {
                    const user = users[0];
                    showResult(`âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­!\nğŸ‘¤ ${user.name}\nğŸ’° Ø§Ù„Ø±ØµÙŠØ¯: ${user.balance || 0}$`, 'success');
                    
                    // Ø­ÙØ¸ ÙÙŠ localStorage
                    localStorage.setItem('current_user', JSON.stringify(user));
                } else {
                    // Ø¬Ø±Ø¨ ahmed
                    const response2 = await fetch(`${SUPABASE_URL}/rest/v1/users?username=eq.ahmed&password=eq.123456&select=*`, {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    });
                    const users2 = await response2.json();
                    
                    if (users2 && users2.length > 0) {
                        showResult(`âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­!\nğŸ‘¤ ${users2[0].name}`, 'success');
                        localStorage.setItem('current_user', JSON.stringify(users2[0]));
                    } else {
                        showResult('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… admin Ø£Ùˆ ahmed ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    }
                }
            } catch (error) {
                showResult(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        // 5. ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªØ®Ø²ÙŠÙ†
        function clearStorage() {
            localStorage.clear();
            sessionStorage.clear();
            showResult('âœ… ØªÙ… ØªÙ†Ø¸ÙŠÙ localStorage Ùˆ sessionStorage', 'success');
        }

        // ØªØ´ØºÙŠÙ„ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            setTimeout(testConnection, 500);
        };
    </script>
</body>
</html>
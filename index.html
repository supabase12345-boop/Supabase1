<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>منصة الاستثمار</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Supabase Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Supabase Config -->
    <script src="./supabase.js"></script>

    <style>
        body {
            margin: 0;
            font-family: Arial;
            background: #0f172a;
            color: white;
        }

        header {
            background: #1e293b;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            background: #3b82f6;
            border: none;
            padding: 8px 15px;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        .packages {
            padding: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fill,minmax(250px,1fr));
            gap: 20px;
        }

        .card {
            background: #1e293b;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .card h2 {
            color: #22c55e;
        }

        .message {
            text-align: center;
            margin-top: 20px;
            font-size: 18px;
        }
    </style>
</head>

<body>

<header>
    <h2>منصة الاستثمار</h2>
    <button class="btn" onclick="goDashboard()">لوحة التحكم</button>
</header>

<h2 style="text-align:center;margin-top:20px;">الباقات المتاحة</h2>

<div id="packagesGrid" class="packages">
    <p class="message">جاري التحميل...</p>
</div>

<script>

document.addEventListener("DOMContentLoaded", () => {
    loadPackages();
});

// ======================================
// تحميل الباقات
// ======================================

async function loadPackages() {

    const grid = document.getElementById("packagesGrid");

    try {

        const client = window.supabaseClient;

        if (!client) {
            throw new Error("Supabase غير مهيأ");
        }

        const { data, error } = await client
            .from("packages")
            .select("*")
            .order("price", { ascending: true });

        if (error) throw error;

        if (!data || data.length === 0) {
            grid.innerHTML =
                "<p class='message'>⚠️ لا توجد باقات حالياً</p>";
            return;
        }

        let html = "";

        data.forEach(pkg => {

            const dailyProfit =
                (pkg.price * (pkg.profit || 2.5) / 100).toFixed(2);

            html += `
                <div class="card">
                    <h3>${pkg.name}</h3>
                    <p>${pkg.description || ""}</p>
                    <h2>${pkg.price}$</h2>
                    <p>ربح يومي: ${dailyProfit}$</p>
                </div>
            `;
        });

        grid.innerHTML = html;

    } catch (err) {

        grid.innerHTML =
            "<p class='message' style='color:red;'>❌ " + err.message + "</p>";

    }

}

// ======================================

function goDashboard() {
    window.location.href = "dashboard.html";
}

</script>

</body>
</html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Investors - Ù…Ù†ØµØ© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- ========== 1. ØªØ­Ù…ÙŠÙ„ Supabase Ø£ÙˆÙ„Ø§Ù‹ ========== -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- ========== 2. ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase Ø«Ø§Ù†ÙŠØ§Ù‹ ========== -->
    <script src="supabase-config.js"></script>
    
    <!-- ========== 3. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ø«Ø§Ù„Ø«Ø§Ù‹ ========== -->
    <script src="shared-data.js"></script>
    
    <style>
        /* ========== Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª ========== */
        :root {
            --primary: #7c3aed;
            --secondary: #06b6d4;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --purple: #8b5cf6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', 'Arial', sans-serif;
        }
        
        body {
            background: var(--dark);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* ========== Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ========== */
        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
            gap: 20px;
        }
        
        .loader-spinner {
            width: 70px;
            height: 70px;
            border: 5px solid rgba(124,58,237,0.2);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }
        
        .loader-text {
            color: white;
            font-size: 20px;
            font-weight: 500;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .main-content {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loaderContainer" class="loader-container">
        <div class="loader-spinner"></div>
        <div class="loader-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ©...</div>
        <div style="color: #94a3b8; margin-top: 10px; font-size: 14px;" id="debugInfo">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div id="mainContent" class="main-content">
        <!-- Ù‡Ù†Ø§ Ù…Ø­ØªÙˆÙ‰ ØµÙØ­ØªÙƒ -->
        <h1 style="color: white; text-align: center; margin-top: 50px;">ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…</h1>
    </div>

    <script>
        // ========== Ø¥Ø¹Ø¯Ø§Ø¯ Supabase Ù…Ø¨Ø§Ø´Ø± ==========
        const SUPABASE_URL = 'https://wabyirjjhndrwxvcrdvn.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndhYnlpcmpqaG5kcnd4dmNyZHZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4OTM0OTAsImV4cCI6MjA4NjQ2OTQ5MH0.AWDpHfWQLBto-Jn8_9fO0UmPS5Da9pgX611Bl6Q6u2w';
        
        let supabase = null;
        let initAttempts = 0;
        const MAX_ATTEMPTS = 30;
        
        // ========== ØªÙ‡ÙŠØ¦Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø°Ø§ØªÙŠ ==========
        async function initApp() {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„... Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©:', initAttempts + 1);
            
            try {
                // âœ… 1. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…ÙƒØªØ¨Ø© Supabase
                if (typeof window.supabase === 'undefined') {
                    throw new Error('Ù…ÙƒØªØ¨Ø© Supabase ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©');
                }
                
                document.getElementById('debugInfo').innerHTML = 'âœ… Ù…ÙƒØªØ¨Ø© Supabase Ù…ØªÙˆÙØ±Ø©... Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
                
                // âœ… 2. Ø¥Ù†Ø´Ø§Ø¡ Ø§ØªØµØ§Ù„ Supabase
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
                    auth: {
                        persistSession: true,
                        autoRefreshToken: true,
                        detectSessionInUrl: true
                    }
                });
                
                document.getElementById('debugInfo').innerHTML = 'âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase... Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©';
                
                // âœ… 3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) throw error;
                
                document.getElementById('debugInfo').innerHTML = 'âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©... Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                
                // âœ… 4. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
                const { data: packages, error: packagesError } = await supabase
                    .from('packages')
                    .select('*')
                    .eq('status', 'active')
                    .limit(1);
                
                if (packagesError) {
                    console.warn('âš ï¸ ØªØ­Ø°ÙŠØ±: Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª', packagesError);
                } else {
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                }
                
                // âœ… 5. Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠÙ‡ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ØŒ Ø­ÙˆÙ„ Ù„Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                if (session) {
                    document.getElementById('debugInfo').innerHTML = `ğŸ‘¤ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„: ${session.user.email} - Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...`;
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1500);
                    return;
                }
                
                // âœ… 6. Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… - Ø£Ø®ÙÙ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ£Ø¸Ù‡Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰
                document.getElementById('debugInfo').innerHTML = 'âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                setTimeout(() => {
                    document.getElementById('loaderContainer').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                }, 500);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£:', error);
                
                initAttempts++;
                
                if (initAttempts < MAX_ATTEMPTS) {
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
                    document.getElementById('debugInfo').innerHTML = `âš ï¸ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ${initAttempts}/${MAX_ATTEMPTS}... ${error.message}`;
                    setTimeout(initApp, 1000);
                } else {
                    // ÙØ´Ù„ Ù†Ù‡Ø§Ø¦ÙŠ
                    document.getElementById('loaderContainer').innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 60px; color: var(--warning); margin-bottom: 20px;"></i>
                            <div style="color: white; font-size: 24px; margin-bottom: 15px;">ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                            <p style="color: #94a3b8; margin-bottom: 25px;">${error.message}</p>
                            <button onclick="location.reload()" style="background: var(--primary); color: white; border: none; padding: 15px 40px; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer;">
                                <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                            </button>
                        </div>
                    `;
                }
            }
        }

        // ========== Ø¨Ø¯Ø£ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ==========
        setTimeout(initApp, 100);
    </script>
</body>
</html>